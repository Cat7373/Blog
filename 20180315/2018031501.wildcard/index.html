<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css" integrity="sha512-G5951zOJGJPw43V0pp5ivIq4R7h2VRGan4XThJJkQ2JHGPew8NbMweLVeXfIh2W+n5EReQqPHpMEam68pT9qCg==" crossorigin="anonymous"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css" integrity="sha512-L7MWcK7FNPcwNqnLdZq86lTHYLdQqZaz5YcAgE+5cnGmlw8JT03QB2+oxL100UeB6RlzZLUxCGSS4/++mNZdxw==" crossorigin="anonymous"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"blog.cat73.org",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前言从去年开始，这个小博客一直在用Let’s Encrypt的免费证书。昨天ACMEv2节点终于正式公布了，所以借着这个时机换了一整套证书配置，具体如下：  将证书签发工具从CertBot更换为acme.sh NS服务商由1984 Hosting更换为Cloudflare 将RSA4096的证书更换为ECC384 换用通配符证书  从上次写Https配置的文档到现在，已经有很多地方做过变更了。所以"><meta property="og:type" content="article"><meta property="og:title" content="本站已启用通配符证书"><meta property="og:url" content="https://blog.cat73.org/20180315/2018031501.wildcard/index.html"><meta property="og:site_name" content="Cat73 Blog"><meta property="og:description" content="前言从去年开始，这个小博客一直在用Let’s Encrypt的免费证书。昨天ACMEv2节点终于正式公布了，所以借着这个时机换了一整套证书配置，具体如下：  将证书签发工具从CertBot更换为acme.sh NS服务商由1984 Hosting更换为Cloudflare 将RSA4096的证书更换为ECC384 换用通配符证书  从上次写Https配置的文档到现在，已经有很多地方做过变更了。所以"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2018-03-15T01:38:00.000Z"><meta property="article:modified_time" content="2018-04-06T13:38:15.000Z"><meta property="article:author" content="Cat73"><meta property="article:tag" content="Nginx"><meta property="article:tag" content="Https"><meta property="article:tag" content="Let’s Encrypt"><meta property="article:tag" content="acme.sh"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://blog.cat73.org/20180315/2018031501.wildcard/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>本站已启用通配符证书 | Cat73 Blog</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Cat73 Blog</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">喵星人占领地球战略指挥部</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i> 关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档</a></li></ul></nav></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/Cat7373" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener noreferrer" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.cat73.org/20180315/2018031501.wildcard/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/upload/headimg.jpg"><meta itemprop="name" content="Cat73"><meta itemprop="description" content="大家好窝萌是来统治蓝星人和汪星人的喵星人"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Cat73 Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 本站已启用通配符证书<a href="https://github.com/Cat7373/Blog/tree/src/source/_posts/2018031501.wildcard.md" class="post-edit-link" title="编辑" rel="noopener noreferrer" target="_blank"><i class="fa fa-pencil-alt"></i></a></h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-03-15 09:38:00" itemprop="dateCreated datePublished" datetime="2018-03-15T09:38:00+08:00">2018-03-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2018-04-06 21:38:15" itemprop="dateModified" datetime="2018-04-06T21:38:15+08:00">2018-04-06</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Https/" itemprop="url" rel="index"><span itemprop="name">Https</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>从去年开始，这个小博客一直在用<code>Let’s Encrypt</code>的免费证书。<br>昨天<code>ACMEv2</code>节点终于正式公布了，所以借着这个时机换了一整套证书配置，具体如下：</p><ol><li>将证书签发工具从<code>CertBot</code>更换为<code>acme.sh</code></li><li><code>NS</code>服务商由<code>1984 Hosting</code>更换为<code>Cloudflare</code></li><li>将<code>RSA4096</code>的证书更换为<code>ECC384</code></li><li>换用通配符证书</li></ol><p>从上次写<code>Https</code>配置的文档到现在，已经有很多地方做过变更了。<br>所以借这个时机，重新来记录一下现在签发证书的整个流程，已备以后查阅。</p><a id="more"></a><h2 id="acme-sh"><a href="#acme-sh" class="headerlink" title="acme.sh"></a>acme.sh</h2><p>将<code>CertBot</code>更换<code>acme.sh</code>的主要原因是它支持<code>ECC</code>证书。<br>我想用<code>ECC</code>证书已经很久了，正好借这个时机换掉。</p><p><code>acme.sh</code>跟<code>CertBot</code>比还有一些其他优点，如：</p><ol><li>几乎无环境依赖，任意用户都可以安装，无需<code>root</code>，所有文件都会生成在<code>~</code>下的一个目录里，卸载只需要删掉这个目录即可<ul><li>好吧还得删掉<code>crontab</code>里的任务，不过不删也没啥影响</li></ul></li><li>带自动更新功能，不用整天手动检查了</li><li>自动配置<code>crontab</code>任务来更新证书，无需自己折腾</li><li>支持<code>DNS</code>模式，以及自动设置<code>DNS</code>记录来实现全自动更新通过<code>DNS</code>挑战签发的证书(通配符目前只支持<code>DNS</code>挑战)<ul><li>没仔细研究<code>certbot</code>是否支持<code>DNS</code>模式，至少<code>certbot --help</code>没看到相关命令，如果有请回复指正谢谢~</li></ul></li></ol><h3 id="安装acme-sh"><a href="#安装acme-sh" class="headerlink" title="安装acme.sh"></a>安装<code>acme.sh</code></h3><p>参照<a href="https://acme.sh" target="_blank" rel="noopener noreferrer">官网</a>的文档，安装非常简单，只需要执行一条命令即可：</p><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://get.acme.sh | sh</span><br></pre></td></tr></tbody></table></figure><p>虽然<code>acme.sh</code>本身无权限要求，但为了之后的证书更新后自动重启<code>Nginx</code>，这时候最好还是用<code>root</code>来安装。</p><h2 id="更换-NS-服务商为Cloudflare"><a href="#更换-NS-服务商为Cloudflare" class="headerlink" title="更换 NS 服务商为Cloudflare"></a>更换 NS 服务商为<code>Cloudflare</code></h2><p>由于想签通配符证书，而<code>ACMEv2</code>要求通配符只能用<code>DNS</code>挑战，所以需要一家支持通过<code>API</code>更新<code>DNS</code>记录的<code>NS</code>。<br>之前用的<code>1984 Hosting</code>翻了半天没找到，大概是不支持。<br>然后就直接拿<code>acme.sh</code>文档里<code>DNS API</code>支持列表里的第一家<code>Cloudflare</code>来用了。</p><p>简单看了下<code>Cloudflare</code>的好处：</p><ol><li>支持<code>IPv6</code>，之前那家不支持</li><li>有<code>API</code>，可以让证书签发工具自动更新</li><li>知名度更高，大概会更稳定更快一些吧</li></ol><h3 id="更换流程"><a href="#更换流程" class="headerlink" title="更换流程"></a>更换流程</h3><ol><li>打开<a href="https://www.cloudflare.com" target="_blank" rel="noopener noreferrer">Cloudflare 官网</a>，注册(登录)账号</li><li>点右上角的<code>+ Add Site</code>，然后一步步照着流程走即可</li><li>去<code>Crypto</code>设置，把<code>SSL</code>改为<code>Off</code>，最下面点<code>Disable Universal SSL</code>按钮</li><li>去<code>DNS</code>设置，检查之前域名的解析是否都挪过来了，如果没有则需要手动添加(我的自动添加的就少了几个)</li><li>去<code>DNS</code>设置，禁用所有域名右边的小云彩图标，这个开启时别人是无法解析到你的服务器地址的，只能解析到<code>Cloudflare</code>到<code>CDN</code>服务器</li></ol><h3 id="开启-DNS-CAA"><a href="#开启-DNS-CAA" class="headerlink" title="开启 DNS CAA"></a>开启 DNS CAA</h3><p>DNS CAA 可限制你的域名只有特定的证书签发机构可以签发证书，且无权签发的签发机构收到签发证书申请时会给你发邮件提醒<br>之前那篇文章里说的开启方式其实是错误的，在这里重新写一下：</p><ol><li>添加<code>CAA</code>记录，<code>Name</code>为你的根域名，<code>Tag</code>为<code>Allow wildcards and specific hostnames</code>，<code>Value</code>为<code>letsencrypt.org</code></li><li>添加<code>CAA</code>记录，<code>Name</code>为你的根域名，<code>Tag</code>为<code>Send violation reports to URL</code>，<code>Value</code>为<code>mailto:你的邮箱</code></li><li>添加完毕后可以通过<code>dig caa 你的域名</code>来验证是否成功，记录值会像这样：<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat73.org.              300     IN      CAA     0 iodef "mailto:root@cat73.org"</span><br><span class="line">cat73.org.              300     IN      CAA     0 issue "letsencrypt.org"</span><br></pre></td></tr></tbody></table></figure></li></ol><h3 id="获取-API-Key"><a href="#获取-API-Key" class="headerlink" title="获取 API Key"></a>获取 API Key</h3><p>这一步是为了让<code>acme.sh</code>能自动设置<code>DNS</code>记录来自动更新证书的。</p><ol><li>打开<a href="https://www.cloudflare.com" target="_blank" rel="noopener noreferrer">Cloudflare 官网</a>，登录账号</li><li>打开<a href="https://www.cloudflare.com/a/profile" target="_blank" rel="noopener noreferrer">个人配置</a></li><li>点击下方<code>API Key</code>中的<code>Global API Key</code>右边的<code>View API Key</code></li><li>将上一步查询到的<code>Key</code>保存备用<ul><li>注意：就像查看时它告诉你的，像保护你的密码似的保护这个<code>Key</code>，一定不要泄漏</li></ul></li></ol><h2 id="签发证书"><a href="#签发证书" class="headerlink" title="签发证书"></a>签发证书</h2><p>编写一个<code>shell</code>文件，然后执行它来签发第一次证书：</p><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> CF_Key=<span class="string">"你刚刚获取到的 API Key"</span></span><br><span class="line"><span class="built_in">export</span> CF_Email=<span class="string">"你在 Cloudflare 注册时使用的邮箱"</span></span><br><span class="line"></span><br><span class="line">/root/.acme.sh/acme.sh \</span><br><span class="line">        --issue \</span><br><span class="line">        -d cat73.org \</span><br><span class="line">        -d *.cat73.org \</span><br><span class="line">        --dns dns_cf \</span><br><span class="line">        --dnssleep 30 \</span><br><span class="line">        --keylength ec-384 \</span><br><span class="line">        --ocsp \</span><br><span class="line">        --force</span><br></pre></td></tr></tbody></table></figure><p>上面是我用的，用之前记得把<code>-d</code>后面的改成自己的域名，<code>--force</code>是为了在尚未过期的时候强制更新证书(方便改参数测试)<br>我的博客向来是不考虑旧浏览器兼容的，性能也排在安全之后，所以直接只用一张<code>ec-384</code>的证书，如果你要考虑兼容性，可能需要删掉<code>keylength</code>参数</p><h2 id="自动复制证书"><a href="#自动复制证书" class="headerlink" title="自动复制证书"></a>自动复制证书</h2><p><code>acme.sh</code>不建议直接使用<code>~/.acme.sh</code>中的内容，因为其结构随时都可能改变。<br>因此可以添加两个参数，让<code>acme.sh</code>在证书生成后替你把证书<code>copy</code>出来，如：</p><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--key-file <span class="string">"/etc/nginx/ssl/cat73.org/key.key"</span> \</span><br><span class="line">--fullchain-file <span class="string">"/etc/nginx/ssl/cat73.org/fullchain.cer"</span> \</span><br></pre></td></tr></tbody></table></figure><h2 id="自动重启-Web-服务器"><a href="#自动重启-Web-服务器" class="headerlink" title="自动重启 Web 服务器"></a>自动重启 Web 服务器</h2><p>证书签发后，<code>Web 服务器</code>一般不会自动重载证书，这时可以让<code>acme.sh</code>替你自动重启。<br>只需要添加一个参数，如我的<code>Nginx</code>：</p><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--reloadcmd <span class="string">"/etc/init.d/nginx reload"</span> \</span><br></pre></td></tr></tbody></table></figure><h2 id="自动续期"><a href="#自动续期" class="headerlink" title="自动续期"></a>自动续期</h2><p>前面说了，<code>acme.sh</code>会自动配置<code>crontab</code>来自动续签证书，所以就不用为这个操心了。</p><h2 id="Nginx-配置"><a href="#Nginx-配置" class="headerlink" title="Nginx 配置"></a>Nginx 配置</h2><p>我的<code>nginx.conf</code>中<code>SSL</code>部分的配置</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">##</span><br><span class="line"># SSL Settings</span><br><span class="line">##</span><br><span class="line"></span><br><span class="line">ssl_protocols TLSv1.2; # Dropping SSLv3, ref: POODLE</span><br><span class="line">ssl_prefer_server_ciphers on;</span><br><span class="line"># ECC 证书只能用 ECDSA 的 cipher；如果想在 SSLLabs 得满分，那就不能支持 AES128</span><br><span class="line">ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA';</span><br><span class="line"># Let’s Encrypt 签的证书是 secp384r1 的，因此这两个顺序可以调换，sect571r1 并不能带来更高的安全性</span><br><span class="line"># 如果是 OpenSSL 1.1.x，则可额外添加 X25519，但会导致 SSLLabs 无法得到满分</span><br><span class="line">ssl_ecdh_curve sect571r1:secp384r1;</span><br><span class="line"></span><br><span class="line"># 启用 SSL Session 加快重连</span><br><span class="line">ssl_session_timeout 1d;</span><br><span class="line">ssl_session_cache shared:SSL:20m;</span><br><span class="line"></span><br><span class="line"># 启用 OCSP 服务器装订加快浏览器 SSL 握手</span><br><span class="line">ssl_stapling on;</span><br><span class="line">ssl_stapling_verify on;</span><br></pre></td></tr></tbody></table></figure><p>针对域名的配置(以本博客为例)：</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">server {</span><br><span class="line">    # 启用 HTTP2</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    server_name blog.cat73.org;</span><br><span class="line"></span><br><span class="line">    # 配置证书路径</span><br><span class="line">    ssl_certificate /etc/nginx/ssl/cat73.org/fullchain.cer;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/cat73.org/key.key;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # 启用 HSTS</span><br><span class="line">    add_header Strict-Transport-Security max-age=15768000 always;</span><br><span class="line">    # 当浏览器检测到 XSS 时拒绝加载页面</span><br><span class="line">    add_header X-XSS-Protection "1; mode=block" always;</span><br><span class="line">    # 禁止被嵌套在非同域的框架中</span><br><span class="line">    add_header X-Frame-Options SAMEORIGIN always;</span><br><span class="line">    # 禁止内容类型猜解</span><br><span class="line">    add_header X-Content-Type-Options nosniff always;</span><br><span class="line">    # CSP 内容控制策略</span><br><span class="line">    add_header Content-Security-Policy "default-src 'none'; child-src *.disqus.com; connect-src *.disqus.com; font-src 'self'; img-src 'self' *.disqus.com *.disquscdn.com; script-src 'self' 'unsafe-inline' *.disqus.com *.disquscdn.com; style-src 'self' *.disquscdn.com;" always;</span><br><span class="line">    # 在使用缓存之前必须向服务器确认</span><br><span class="line">    add_header Cache-Control no-cache always;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # 网站静态文件存放路径</span><br><span class="line">    root /var/www/blog;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><ul><li><a href="https://acme.sh" target="_blank" rel="noopener noreferrer">acme.sh</a></li><li><a href="https://www.cloudflare.com" target="_blank" rel="noopener noreferrer">Cloudflare</a></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/Nginx/" rel="tag"># Nginx</a> <a href="/tags/Https/" rel="tag"># Https</a> <a href="/tags/Let%E2%80%99s-Encrypt/" rel="tag"># Let’s Encrypt</a> <a href="/tags/acme-sh/" rel="tag"># acme.sh</a></div><div class="post-nav"><div class="post-nav-item"><a href="/20180119/2018011901.druid-springboot2/" rel="prev" title="突然莫名悲哀，为啥都说国内技术不如国外"><i class="fa fa-chevron-left"></i> 突然莫名悲哀，为啥都说国内技术不如国外</a></div><div class="post-nav-item"> <a href="/20180930/20180930.ipv6-tls13/" rel="next" title="本站已支持 IPv6 和 TLS1.3">本站已支持 IPv6 和 TLS1.3<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#acme-sh"><span class="nav-number">2.</span> <span class="nav-text">acme.sh</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装acme-sh"><span class="nav-number">2.1.</span> <span class="nav-text">安装acme.sh</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更换-NS-服务商为Cloudflare"><span class="nav-number">3.</span> <span class="nav-text">更换 NS 服务商为Cloudflare</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#更换流程"><span class="nav-number">3.1.</span> <span class="nav-text">更换流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开启-DNS-CAA"><span class="nav-number">3.2.</span> <span class="nav-text">开启 DNS CAA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取-API-Key"><span class="nav-number">3.3.</span> <span class="nav-text">获取 API Key</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#签发证书"><span class="nav-number">4.</span> <span class="nav-text">签发证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自动复制证书"><span class="nav-number">5.</span> <span class="nav-text">自动复制证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自动重启-Web-服务器"><span class="nav-number">6.</span> <span class="nav-text">自动重启 Web 服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自动续期"><span class="nav-number">7.</span> <span class="nav-text">自动续期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nginx-配置"><span class="nav-number">8.</span> <span class="nav-text">Nginx 配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Links"><span class="nav-number">9.</span> <span class="nav-text">Links</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Cat73" src="/upload/headimg.jpg"><p class="site-author-name" itemprop="name">Cat73</p><div class="site-description" itemprop="description">大家好窝萌是来统治蓝星人和汪星人的喵星人</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">20</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">26</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/Cat7373" title="Github → https://github.com/Cat7373" rel="noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> Github</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://notes.jimliang.com/" title="http://notes.jimliang.com/" rel="noopener noreferrer" target="_blank">Jim's Notes</a></li><li class="links-of-blogroll-item"> <a href="https://www.locsian.com/" title="https://www.locsian.com" rel="noopener noreferrer" target="_blank">Locsian's Blog</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> © 2016 – <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Cat73</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener noreferrer" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer></div><script src="/lib/anime.min.js" integrity="sha512-PtERWMgvZ4H5VEu6gEcSap5qoi/OQksnTw+B4/0wyPrCe7Lbz1tl3piTtuNcOCV5OEXFFePqVTJW3h9Aacj2sA==" crossorigin="anonymous"></script><script src="/lib/velocity/velocity.min.js" integrity="sha512-r+WC4s/o+ePgGesrHDTOQpOHFMQH39icY2OUcaUU6SrFbi1keeuy3jHq8Q0SIuACtfZ7zRfPWYt0huP/guuU2w==" crossorigin="anonymous"></script><script src="/lib/velocity/velocity.ui.min.js" integrity="sha512-48rakD7aXAKjynjPfmdjgeHrLZcVimYHIq4hS4emn7MMLhfcpS5Mt4Mn3HeCr4vMGKUKgfoZ++ceCeR6UAKhWA==" crossorigin="anonymous"></script><script src="/js/utils.js" integrity="sha512-xlafgwhcUyEE7HKDpyNDzbdm7SXcIlSGFmOWE2dm+fd8ZRANLYNFJLFjWSEXt14bKbfWMsfx3ibJcljCQcCE2Q==" crossorigin="anonymous"></script><script src="/js/motion.js" integrity="sha512-aFZpRY3gmkyHYWIlJD7wZs2wzIAIqwSazgtis0Va5rGJZdj7QwXfYqdlb3LBARYJF4TTN0+O1BVAnJ6vTTob/A==" crossorigin="anonymous"></script><script src="/js/schemes/pisces.js" integrity="sha512-A2xN5D3dzTOGw6kMAcQxECrxdn/LqzrehzaNQvm1n/06t91TyvJ85eXkBhaV5XelEmMVEFYkGPaKtkGRm4YuPQ==" crossorigin="anonymous"></script><script src="/js/next-boot.js" integrity="sha512-zv9gPg6GY1OHOqhAqp2NTAf+UOMVCD++HCRqoKgfhhKi7R5Rsy7V13qKbd+ibbhkqYP5xQEvyW9L7W3hGw7juA==" crossorigin="anonymous"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '7e893f940e4723d2af60',
      clientSecret: 'b5336eb0b13e2b09d26bc6f7fc84752c7c104db3',
      repo        : 'Blog',
      owner       : 'Cat7373',
      admin       : ['Cat7373'],
      id          : '0ef7d4a43f1a178c204aa7b06f2cafef',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>