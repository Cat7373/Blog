<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0"><link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css?v=7.4.0" integrity="sha512-YxbzXZ23496tdVZDcDIgmsHNhDkHQMxcfEBEHiQDawmb7QqU3VD+CKgMpYG1/XRFi2VoIXKsZ3pHY7rkddXcsg==" crossorigin="anonymous"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.4.0",exturl:!1,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"复制",copy_success:"复制成功",copy_failure:"复制失败"},sidebarPadding:40}</script><meta name="description" content="前言 之前博客用的是Github Pages，不支持HTTPS，也就没怎么折腾，最近买了个小VPS，于是开始瞎折腾。最近被运营商劫持弄的烦的要死，偏偏我还不知道宽带帐号不好投诉，开自己的博客居然被嵌入广告。。。于是把博客搬到了服务器上，并通过Let’s Encrypt的免费证书开启了HTTPS。然后又看到了ssllabs这个大坑，于是开始了我的折腾之旅，折腾数日终于满分了。。。在这写篇文章把折腾的"><meta name="keywords" content="Https,Let’s Encrypt"><meta property="og:type" content="article"><meta property="og:title" content="用 Let’s Encrypt 免费证书开启 HTTPS 并获得 ssllabs 满分的过程"><meta property="og:url" content="https://blog.cat73.org/20170716/2017071601.https/index.html"><meta property="og:site_name" content="Cat73 Blog"><meta property="og:description" content="前言 之前博客用的是Github Pages，不支持HTTPS，也就没怎么折腾，最近买了个小VPS，于是开始瞎折腾。最近被运营商劫持弄的烦的要死，偏偏我还不知道宽带帐号不好投诉，开自己的博客居然被嵌入广告。。。于是把博客搬到了服务器上，并通过Let’s Encrypt的免费证书开启了HTTPS。然后又看到了ssllabs这个大坑，于是开始了我的折腾之旅，折腾数日终于满分了。。。在这写篇文章把折腾的"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2019-06-02T00:31:38.377Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="用 Let’s Encrypt 免费证书开启 HTTPS 并获得 ssllabs 满分的过程"><meta name="twitter:description" content="前言 之前博客用的是Github Pages，不支持HTTPS，也就没怎么折腾，最近买了个小VPS，于是开始瞎折腾。最近被运营商劫持弄的烦的要死，偏偏我还不知道宽带帐号不好投诉，开自己的博客居然被嵌入广告。。。于是把博客搬到了服务器上，并通过Let’s Encrypt的免费证书开启了HTTPS。然后又看到了ssllabs这个大坑，于是开始了我的折腾之旅，折腾数日终于满分了。。。在这写篇文章把折腾的"><link rel="canonical" href="https://blog.cat73.org/20170716/2017071601.https/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>用 Let’s Encrypt 免费证书开启 HTTPS 并获得 ssllabs 满分的过程 | Cat73 Blog</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container use-motion"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Cat73 Blog</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">喵星人占领地球战略指挥部</h1></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li></ul></nav></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/Cat7373" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener noreferrer" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article itemscope itemtype="http://schema.org/Article"><div class="post-block post"><link itemprop="mainEntityOfPage" href="https://blog.cat73.org/20170716/2017071601.https/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Cat73"><meta itemprop="description" content="大家好窝萌是来统治蓝星人和汪星人的喵星人"><meta itemprop="image" content="/upload/headimg.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Cat73 Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">用 Let’s Encrypt 免费证书开启 HTTPS 并获得 ssllabs 满分的过程<a href="https://github.com/Cat7373/Blog/tree/src/source/_posts/_posts/2017071601.https.md" class="post-edit-link" title="编辑" rel="noopener noreferrer" target="_blank"><i class="fa fa-pencil"></i></a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-07-16 15:43:00" itemprop="dateCreated datePublished" datetime="2017-07-16T15:43:00+08:00">2017-07-16</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-06-02 08:31:38" itemprop="dateModified" datetime="2019-06-02T08:31:38+08:00">2019-06-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Https/" itemprop="url" rel="index"><span itemprop="name">Https</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>之前博客用的是<code>Github Pages</code>，不支持<code>HTTPS</code>，也就没怎么折腾，最近买了个小<code>VPS</code>，于是开始瞎折腾。<br>最近被运营商劫持弄的烦的要死，偏偏我还不知道宽带帐号不好投诉，开自己的博客居然被嵌入广告。。。<br>于是把博客搬到了服务器上，并通过<code>Let’s Encrypt</code>的免费证书开启了<code>HTTPS</code>。<br>然后又看到了<code>ssllabs</code>这个大坑，于是开始了我的折腾之旅，折腾数日终于满分了。。。<br>在这写篇文章把折腾的过程记下来。。。顺便把以前写的凑数的文章都删掉了。。。</p></blockquote><a id="more"></a><h2 id="通过Let’s-Encrypt开启HTTPS"><a href="#通过Let’s-Encrypt开启HTTPS" class="headerlink" title="通过Let’s Encrypt开启HTTPS"></a>通过<code>Let’s Encrypt</code>开启<code>HTTPS</code></h2><blockquote><p>开始因为英语不好，明明官网都写得很明白了，然而还是折腾了好久。。。<br>我是使用的<code>Ubuntu 17.04</code>+<code>Nginx 13</code>，不同环境操作过程可能不一样，不要直接照着做。。。<br>先上一个自己域名的满分链接：<a href="https://www.ssllabs.com/ssltest/analyze.html?d=blog.cat73.org" target="_blank" rel="noopener noreferrer">https://www.ssllabs.com/ssltest/analyze.html?d=blog.cat73.org</a></p></blockquote><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ol><li>确保你要申请证书的域名都解析到了这台服务器上，且能直接通过域名访问。</li><li>使用<a href="https://letsencrypt.org/getting-started/" target="_blank" rel="noopener noreferrer">官网</a>推荐的<a href="https://certbot.eff.org/" target="_blank" rel="noopener noreferrer">CertBot</a>获取证书。<br>在<code>CertBot</code>官网选择一下环境(比如我选<code>Nginx</code> on <code>Ubuntu 17.04</code>)就可以看到入门教程了。</li><li>安装<code>CertBot</code><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install software-properties-common</span><br><span class="line">add-apt-repository ppa:certbot/certbot</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install python-certbot-nginx</span><br></pre></td></tr></tbody></table></figure></li></ol><h3 id="获取证书"><a href="#获取证书" class="headerlink" title="获取证书"></a>获取证书</h3><blockquote><p>我是把几个域名都放到一张证书里的，这样可以支持一些比较旧的，不支持<code>SNI</code>的浏览器(虽然我这博客不支持。。)</p></blockquote><ol><li>执行<code>certbot certonly --must-staple --rsa-key-size 4096 -d 域名1 -d 域名2...</code><br>这步的<code>-rsa-key-size 4096</code>是为了<code>ssllabs</code>满分，如果你不想弄这个可以不加，能略微提升网站访问速度。<br>每个<code>-d</code>后面跟一个域名，有多少个域名跟多少个</li><li>运行后它会让你选验证模式，我这里已经开启了<code>nginx</code>，因此选<code>2</code>，自己设置<code>webroot</code></li><li>选<code>1</code>然后输入你的网站静态文件所在的目录，如我的<code>Nginx</code>默认是<code>/var/www/html</code></li><li>之后每一个域名都需要设置，如果你所有域名都在一个目录，直接选<code>2</code>使用第一次输入的路径即可</li><li>输入完最后一个域名后，它会提示你申请结果，如果失败请检查失败原因后重试，如果成功继续下一步<br>我一开始因为用了国内的<code>NS</code>服务商，然后<code>Let’s Encrypt</code>访问不到就失败了，这货不会信任任何<code>DNS</code>服务器给出的服务器地址，必须要直接访问权威<code>NS</code>服务器查询的结果才可以，因此如果你因为这个失败了，建议更换一些国外的免费<code>NS</code>服务商。</li><li>如果成功会告诉你申请成功，并给出你的证书路径，比如我的：<code>/etc/letsencrypt/live/cat73.org/fullchain.pem</code><br>记下这个路径(不包括<code>fullchain.pem</code>的部分，稍后用得着)</li></ol><h2 id="配置-DNS-CAA"><a href="#配置-DNS-CAA" class="headerlink" title="配置 DNS CAA"></a>配置 DNS CAA</h2><blockquote><p>DNS CAA 可限制你的域名只有特定的证书签发机构可以签发证书，且无权签发的签发机构收到签发证书申请时会给你发邮件提醒<br>这步不影响<code>ssllabs</code>评分，可不做</p></blockquote><ol><li><p>你需要找一家支持<code>CAA</code>记录的<code>NS</code>服务商，国内似乎没有。。。<br>我找了半天找到一家国外的：<a href="https://www.1984hosting.com/" target="_blank" rel="noopener noreferrer">https://www.1984hosting.com/</a></p></li><li><p>通过修改域名的<code>NS</code>记录接入到你选择的<code>NS</code>服务商</p></li><li><p>添加<code>CAA</code>记录，比如我的：</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 issue "letsencrypt.org"</span><br><span class="line">1 iodef "root@cat73.org"</span><br></pre></td></tr></tbody></table></figure><p><code>issue</code>是允许哪家证书签发机构签发证书，<code>iodef</code>是你的邮箱地址</p></li><li><p>完成后可以通过<code>dig caa 你的域名</code>来验证是否添加成功</p></li></ol><h2 id="配置-nginx"><a href="#配置-nginx" class="headerlink" title="配置 nginx"></a>配置 nginx</h2><ol><li><p>编辑你每一个申请证书的域名的<code>server</code>配置，设置<code>http</code>直接跳到<code>https</code></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server {</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name 域名;</span><br><span class="line"></span><br><span class="line">  return 307 https://$host$request_uri;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>配置每一个域名的 https</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">server {</span><br><span class="line">  # 如果 http2 报错说明你的 nginx 版本比较低不支持，删掉即可</span><br><span class="line">  listen 443 ssl http2;</span><br><span class="line">  server_name 域名;</span><br><span class="line"></span><br><span class="line">  ssl_certificate 证书路径/fullchain.pem;</span><br><span class="line">  ssl_certificate_key 证书路径/privkey.pem;</span><br><span class="line"></span><br><span class="line">  ssl_trusted_certificate 证书路径/chain.pem;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  # 强制域名使用 HTTPS 打开，且在证书不被信任时不允许用户跳过，这里设置的时间是 182.5 天</span><br><span class="line">  # includeSubDomains 表示包含子域名</span><br><span class="line">  # preload 表示允许被加入浏览器内置的强制 HTTPS 列表中</span><br><span class="line">  add_header Strict-Transport-Security "max-age=15768000; includeSubDomains; preload";</span><br><span class="line">  # 在检测到 XSS 时阻止网页加载</span><br><span class="line">  add_header X-XSS-Protection "1; mode=block";</span><br><span class="line">  # 禁止网页被嵌入 frame(算是避免运营商劫持的办法之一)</span><br><span class="line">  add_header X-Frame-Options DENY;</span><br><span class="line"></span><br><span class="line">  # 后面可以写你的网站之前的代码，如 root /var/www/html;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>配置 nginx.conf，删掉自带的 SSL 配置，用下面的覆盖</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 只支持 TLS1.2，如果`openssl`在`1.1.1`以上，且`nginx`在`1.13`以上，可再加入`TLSv1.3`</span><br><span class="line">ssl_protocols TLSv1.2;</span><br><span class="line">ssl_prefer_server_ciphers on;</span><br><span class="line">ssl_session_timeout 1d;</span><br><span class="line">ssl_session_cache shared:SSL:10m;</span><br><span class="line"></span><br><span class="line">ssl_buffer_size 4k;</span><br><span class="line"></span><br><span class="line">ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA';</span><br><span class="line"></span><br><span class="line">ssl_ecdh_curve sect571r1:secp521r1:brainpoolP512r1:secp384r1:brainpoolP384r1:sect571k1;</span><br><span class="line"></span><br><span class="line">ssl_stapling on;</span><br><span class="line">ssl_stapling_verify on;</span><br></pre></td></tr></tbody></table></figure></li><li><p>开启<code>session_ticket</code></p><ol><li><p>在 nginx 配置目录下执行</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir ssl</span><br><span class="line">openssl rand 80 > ssl/ticket.key</span><br></pre></td></tr></tbody></table></figure></li><li><p>编辑<code>nginx.conf</code>，在<code>SSL</code>配置后面加入下面两行</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_session_ticket_key ssl/ticket.key;</span><br><span class="line">ssl_session_tickets on;</span><br></pre></td></tr></tbody></table></figure></li></ol></li><li><p>使用<code>4096</code>位加密</p><ol><li><p>在 nginx 配置目录下执行</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl dhparam -out ssl/dhparam.pem 4096</span><br></pre></td></tr></tbody></table></figure></li><li><p>编辑<code>nginx.conf</code>，在<code>SSL</code>配置后面加入下面两行</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssl_dhparam ssl/dhparam.pem;</span><br></pre></td></tr></tbody></table></figure></li></ol></li></ol><h2 id="一些额外的配置"><a href="#一些额外的配置" class="headerlink" title="一些额外的配置"></a>一些额外的配置</h2><blockquote><p>完成上面的配置你在<code>ssllabs</code>的评分应该就已经是满分了，但你还可以继续改下面这些，毕竟不折腾能死嘛～<br>什么？还没满分，不要忘了执行<code>nginx -s reload</code>哟。。。<br>如果还没满分，那大概是我这篇文章过时了吧。。。</p></blockquote><ol><li><p>开启 HPKP</p><blockquote><p><code>HPKP</code>可以检查你的证书是不是指定的证书签发机构签的，如果不是会阻止访问，也可配置出现问题时向指定地址报告等</p></blockquote><ol><li>在你的浏览器访问<code>https://www.ssllabs.com/ssltest/analyze.html?d=你的域名</code></li><li>等测试结束后，在页面搜索<code>Certification Paths</code></li><li>点击下面的展开</li><li>把第一行不是你的域名的<code>Pin SHA256</code>的值记录下来</li><li>换一个免费证书，再来一次，比如腾讯云可以申请赛门特克的免费证书</li><li>把你刚刚记下来的几个值(至少4个，无顺序要求)，按下面的格式写入你每一个域名的<code>server</code>配置中<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 如果有更多按照格式加就行</span><br><span class="line">add_header Public-Key-Pins 'pin-sha256="第一个值"; pin-sha256="第二个值"; pin-sha256="第三个值"; pin-sha256="第四个值"; max-age=15768000; includeSubDomains';</span><br></pre></td></tr></tbody></table></figure></li></ol></li><li><p>申请浏览器内置<code>HSTS</code></p><blockquote><p><code>HSTS</code>可以要求用户访问你的网站必须用<code>HTTPS</code>协议，然而需要至少访问一次才会生效，这一次仍然有可能被劫持，而且有可能被一些更无良的运营商给<code>HTTPS</code>强转<code>HTTP</code>，用户永远不会把你加进<code>HSTS</code>名单<br>为了解决这个尴尬的问题，浏览器商们推出了一个申请地址，符合要求的域名可以申请把自己加入浏览器的源代码中，这样用户首次访问的时候也会强制用<code>HTTPS</code>访问<br>请一定注意，一旦申请成功，就没有回头路了，如果哪天你不想用<code>HTTPS</code>了，那就只能换个域名了。</p></blockquote><ol><li>确保你申请证书的时候包含你的主域名，如我的是<code>cat73.org</code>，不能带任何子域名，如<code>www.cat73.org</code>无效</li><li>确保你照做了上面的<code>4.2</code></li><li>访问<a href="https://hstspreload.org/" target="_blank" rel="noopener noreferrer">申请页面</a>，输入你的主域名，提交即可，稍后的提示确认，打勾后再提交即可</li><li>耐心等待审核，一般一个月内可审核完成，审核完成之前请不要修改网站配置。</li></ol></li></ol><h2 id="自动重新签发证书"><a href="#自动重新签发证书" class="headerlink" title="自动重新签发证书"></a>自动重新签发证书</h2><blockquote><p><code>Let’s Encrypt</code>申请的证书只有<code>3</code>个月有效期，每隔<code>3</code>个月都手动来重新签发一次得累死。。。</p></blockquote><ol><li>通过<code>crontab</code>在每月<code>1</code>号自动重新签发证书</li><li>执行<code>crontab -e</code>,添加下面一行保存即可<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * certbot renew --force-renew && /etc/init.d/nginx reload</span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id="参考内容"><a href="#参考内容" class="headerlink" title="参考内容"></a>参考内容</h2><p><a href="https://github.com/ssllabs/research/wiki/SSL-Server-Rating-Guide" target="_blank" rel="noopener noreferrer">ssllabs评分规则</a></p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/Https/" rel="tag"># Https</a> <a href="/tags/Let’s-Encrypt/" rel="tag"># Let’s Encrypt</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/20160806/2016080601.FileReader-read/" rel="next" title="FileReader 是如何读取中文的？"><i class="fa fa-chevron-left"></i> FileReader 是如何读取中文的？</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/20170802/2017080201.nginx-cookie-sucure/" rel="prev" title="用 Nginx 自动给 Cookie 增加 Secure 和 HttpOnly">用 Nginx 自动给 Cookie 增加 Secure 和 HttpOnly<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="gitalk-container"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过Let’s-Encrypt开启HTTPS"><span class="nav-number">2.</span> <span class="nav-text">通过Let’s Encrypt开启HTTPS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#准备工作"><span class="nav-number">2.1.</span> <span class="nav-text">准备工作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取证书"><span class="nav-number">2.2.</span> <span class="nav-text">获取证书</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置-DNS-CAA"><span class="nav-number">3.</span> <span class="nav-text">配置 DNS CAA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置-nginx"><span class="nav-number">4.</span> <span class="nav-text">配置 nginx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一些额外的配置"><span class="nav-number">5.</span> <span class="nav-text">一些额外的配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自动重新签发证书"><span class="nav-number">6.</span> <span class="nav-text">自动重新签发证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考内容"><span class="nav-number">7.</span> <span class="nav-text">参考内容</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/upload/headimg.jpg" alt="Cat73"><p class="site-author-name" itemprop="name">Cat73</p><div class="site-description" itemprop="description">大家好窝萌是来统治蓝星人和汪星人的喵星人</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">17</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">9</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">20</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/Cat7373" title="Github → https://github.com/Cat7373" rel="noopener noreferrer" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://notes.jimliang.com/" title="http://notes.jimliang.com/" rel="noopener noreferrer" target="_blank">Jim's Notes</a></li><li class="links-of-blogroll-item"> <a href="https://www.locsian.com" title="https://www.locsian.com" rel="noopener noreferrer" target="_blank">Locsian's Blog</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">© 2016 – <span itemprop="copyrightYear">2019</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Cat73</span></div><div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener noreferrer" target="_blank">Hexo</a> 强力驱动 v3.9.0</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener noreferrer" target="_blank">NexT.Gemini</a> v7.4.0</div></div></footer></div><script src="/lib/anime.min.js?v=3.1.0" integrity="sha512-PtERWMgvZ4H5VEu6gEcSap5qoi/OQksnTw+B4/0wyPrCe7Lbz1tl3piTtuNcOCV5OEXFFePqVTJW3h9Aacj2sA==" crossorigin="anonymous"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1" integrity="sha512-r+WC4s/o+ePgGesrHDTOQpOHFMQH39icY2OUcaUU6SrFbi1keeuy3jHq8Q0SIuACtfZ7zRfPWYt0huP/guuU2w==" crossorigin="anonymous"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1" integrity="sha512-48rakD7aXAKjynjPfmdjgeHrLZcVimYHIq4hS4emn7MMLhfcpS5Mt4Mn3HeCr4vMGKUKgfoZ++ceCeR6UAKhWA==" crossorigin="anonymous"></script><script src="/js/utils.js?v=7.4.0" integrity="sha512-LOpIrGIVCEx0Py1TA8bWRGsP6VZsiECs1zBUmZKDM/I/ISLhgw1ecGmQIqa+pI+Haf5ev62pX0wzEDCRjqof0A==" crossorigin="anonymous"></script><script src="/js/motion.js?v=7.4.0" integrity="sha512-LgjUCfdnM6/vyS32aSbVpY55e633ZFsnUrt8f9TIiGk43fwd8Q8An4iPlgzqCLMyApR1/fCbay+SXZK3nFCK6g==" crossorigin="anonymous"></script><script src="/js/schemes/pisces.js?v=7.4.0" integrity="sha512-wz0YKVBsH3Q0PN9dUNKpmLbJ6blWeWqZq17f01x/wK4l5FCZfcAoV7Bb30P7+eSB8c45iZL4ZMu1fXdtNyA2zA==" crossorigin="anonymous"></script><script src="/js/next-boot.js?v=7.4.0" integrity="sha512-Tm75fcsw8OxQVEKCVO0dMzhWU0kfaCCmxdlJj724tq20Iu6KyQOWzoe0KJpqsAImYp7cmkzNKQIuPerhH2+1pg==" crossorigin="anonymous"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '7e893f940e4723d2af60',
      clientSecret: 'b5336eb0b13e2b09d26bc6f7fc84752c7c104db3',
      repo: 'Blog',
      owner: 'Cat7373',
      admin: ['Cat7373'],
      id: '5d27ebea5d72d74755aac8974df4e8f8',
        language: window.navigator.language || window.navigator.userLanguage,
      
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script></body></html>