---
title: æ ‘è“æ´¾4b AP æŠ˜è…¾è®°
date: 2020-04-12 10:28:00
categories: Raspberry Pi
tags:
  - Raspberry Pi
  - AP
---
# å‰è¨€
æœ€è¿‘å…¥æ‰‹äº†ä¸€ä¸ªæ ‘è“æ´¾ 4bï¼Œå‡†å¤‡å½“ä½æˆæœ¬å®¶ç”¨æœåŠ¡å™¨ï¼Œç¬¬ä¸€ä¸ªæŠ˜è…¾çš„å°±æ˜¯æŠŠå®ƒåšæˆä¸€ä¸ªè·¯ç”±å™¨

<!-- more -->
# Raspbian
åœ¨æ ‘è“æ´¾å®˜æ–¹ç³»ç»Ÿä¸‹ï¼Œå¯ä»¥ç›´æ¥æ— è„‘å®‰è£…[RaspAP](https://github.com/billz/raspap-webgui)æ¥æä¾› AP åŠŸèƒ½

1. è¯·æ’ä¸Šç½‘çº¿ï¼Œå› ä¸ºæ— çº¿ç½‘å¡éœ€è¦ç”¨äº AP
2. æ‰§è¡Œä¸€é”®å®‰è£…è„šæœ¬

    ```sh
    curl -sL https://install.raspap.com | bash
    ```
3. ç›´æ¥åœ¨æ ‘è“æ´¾ä¸­çš„æµè§ˆå™¨ä¸Šè®¿é—®`http://127.0.0.1`ï¼Œè´¦å·ï¼š`admin`ï¼Œå¯†ç ï¼š`secret`
4. ç®€å•é…ç½®ä¸‹ AP è®¾ç½®å³å¯

* ç”±äºä¸€äº›ä½ æ‡‚å¾—çš„åŸå› ï¼Œä½ å¯èƒ½æ— æ³•ç›´æ¥è®¿é—®æ­¤åŸŸåï¼Œå¯èƒ½éœ€è¦é…ç½®å‰ç½®ä»£ç†ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†

# Ubuntu
> ç”±äº Raspbian æš‚æ—¶æ²¡æ”¯æŒ 64 ä½ï¼Œå¾ˆå¤šè½¯ä»¶ä¸èƒ½ç”¨ï¼Œæ€§èƒ½ä¹Ÿæ— æ³• 100% å‘æŒ¥ï¼Œè¿™å®åœ¨ä¸èƒ½å¿ï¼Œæ‰€ä»¥æ¢ Ubuntu äº†
>
> è€Œ Ubuntu ä¸‹çš„ RaspAP åœ¨å†™è¿™ç¯‡æ–‡ç« æ—¶è¿˜æ²¡æœ‰ç¨³å®šç‰ˆï¼Œå°è¯•å®‰è£…äº†ä¸‹æŠ¥äº†ä¸€å †é”™ï¼Œè¿˜é¡ºä¾¿æŠŠç³»ç»Ÿç½‘ç»œæ•´ç‚¸äº†
>
> äºæ˜¯å†³å®šè‡ªå·±åŠ¨æ‰‹åšäº†ğŸ˜‚

1. å®‰è£…å¿…è¦çš„è½¯ä»¶

    ```sh
    apt-get install dnsmasq hostapd haveged ifupdown2
    ```

2. ä¸ºæ— çº¿ç½‘å¡è®¾ç½®é™æ€ IP

    ç¼–è¾‘`/etc/network/interfaces`ï¼Œåœ¨æœ€åè¿½åŠ å¦‚ä¸‹å†…å®¹ï¼š

    ```
    auto wlan0
    iface wlan0 inet static
        address 192.168.3.1
        netmask 24
    ```

    åŒæ—¶ï¼Œè§‚å¯Ÿæ­¤æ–‡ä»¶å¦‚æœæ²¡æœ‰ç±»ä¼¼ä¸‹é¢çš„å†…å®¹çš„è¯ï¼Œè¿½åŠ ä¸€ä¸‹ï¼š

    ```
    auto lo eth0
    iface lo inet loopback
    iface eth0 inet dhcp
    ```

    æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è®©è®¾ç½®ç”Ÿæ•ˆï¼š

    ```sh
    ifdown wlan0
    ifup wlan0
    ```

3. hostapd é…ç½®(AP)

    ç¼–è¾‘`/etc/default/hostapd`ï¼Œä¿®æ”¹ä¸‹é¢çš„é…ç½®ï¼š

    ```conf
    DAEMON_CONF="/etc/hostapd/hostapd.conf"
    ```

    åˆ›å»º`/etc/hostapd/hostapd.conf`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

    ```conf
    # base
    driver=nl80211
    interface=wlan0
    country_code=CN

    # SSID
    ssid=Cat73
    hw_mode=a
    channel=149

    # secret
    auth_algs=2
    wpa=2
    wpa_passphrase=ChangeMe
    wpa_pairwise=TKIP CCMP
    wpa_key_mgmt=WPA-PSK

    # misc
    wmm_enabled=1
    ieee80211d=0
    ieee80211h=0
    beacon_int=100
    fragm_threshold=2346
    rts_threshold=2347
    ignore_broadcast_ssid=0
    max_num_sta=50

    # N
    ieee80211n=1
    require_ht=1
    ht_capab=[MAX-AMSDU-3839][HT40+][SHORT-GI-20][SHORT-GI-40][DSSS_CCK-40]

    # AC
    ieee80211ac=1
    require_vht=1
    vht_capab=[MAX-AMSDU-3839][SHORT-GI-80]
    vht_oper_chwidth=0
    vht_oper_centr_freq_seg0_idx=151
    ```

    æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å¯ç”¨`hostapd`ï¼š

    ```sh
    systemctl unmask hostapd.service
    systemctl enable hostapd.service
    service hostapd start
    ```

    è¿™æ—¶ä½ åº”è¯¥å·²ç»å¯ä»¥æœåˆ°çƒ­ç‚¹`Cat73`äº†ï¼Œå¯†ç `ChangeMe`ï¼Œä½†è¿æ¥åä¸ä¼šåˆ†é… IP

4. dnsmasq é…ç½®(DHCP)

    ç¼–è¾‘`/etc/dnsmasq.conf`ï¼Œä¿®æ”¹ä¸‹é¢çš„é…ç½®é¡¹ï¼š

    ```conf
    # DNS æœåŠ¡å™¨
    server=1.2.4.8
    interface=wlan0
    # DHCP æ± èŒƒå›´ã€å­ç½‘æ©ç ã€æœ‰æ•ˆæœŸ
    dhcp-range=192.168.3.100,192.168.3.199,255.255.255.0,12h
    # DHCP ä¸‹å‘çš„ DNS è®¾ç½®
    dhcp-option=6,1.2.4.8
    ```

    æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤é‡å¯`dnsmasq`ï¼š

    ```sh
    service dnsmasq restart
    ```

    è¿™æ—¶ä½ å†è¿æ¥ä¼šå‘ç°ï¼Œå¯ä»¥æ­£å¸¸åˆ†é… IP äº†
5. sysctl å¼€å¯ IP åŒ…è½¬å‘

    ç¼–è¾‘`/etc/sysctl.conf`ï¼Œåœ¨æœ€åè¿½åŠ å¦‚ä¸‹å†…å®¹ï¼š

    ```conf
    net.ipv4.ip_forward=1
    net.ipv6.conf.all.forwarding=1
    ```

    ç„¶åæ‰§è¡Œ`sysctl -p`ç”Ÿæ•ˆ
6. è®¾ç½®æ— çº¿ç®¡åˆ¶åŒºåŸŸï¼š
    ```sh
    iw reg set CN
    ```

7. é…ç½®é˜²ç«å¢™ï¼š
    ```sh
    iptables -F
    iptables -X
    iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
    ```

    è¿™æ—¶ï¼Œä½ åº”è¯¥å·²ç»èƒ½æ­£å¸¸çš„ç”¨è¿™ä¸ªçƒ­ç‚¹è”ç½‘äº†

    ç„¶åæŠŠè¿™ä¸ªé…ç½®ä¿å­˜ä¸€ä¸‹ï¼Œä¸ç„¶é‡å¯ä¹‹ååˆä¸èƒ½ç”¨äº†ï¼š

    ```sh
    iptables-save > /etc/iptables.up.rules
    echo '#!/bin/bash' > /etc/network/if-up.d/iptables
    echo '/sbin/iptables-restore < /etc/iptables.up.rules' >> /etc/network/if-up.d/iptables
    chmod +x /etc/iptables.up.rules
    ```

# å‚è€ƒå†…å®¹
* [hostapd.conf](https://w1.fi/cgit/hostap/plain/hostapd/hostapd.conf)
* [RaspAP](https://github.com/billz/raspap-webgui)
* [List_of_WLAN_channels](https://en.wikipedia.org/wiki/List_of_WLAN_channels#5_GHz_or_5.8_GHz_(802.11a/h/j/n/ac/ax))
* [æŠŠæ ‘è“æ´¾é…ç½®æˆæ— çº¿è·¯ç”±å™¨](https://shumeipai.nxez.com/2013/09/11/raspberry-pi-configured-as-a-wireless-router.html)
