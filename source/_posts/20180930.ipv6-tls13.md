---
title: 本站已支持 IPv6 和 TLS1.3
date: 2018-09-30 23:31:00
categories: 水
tags:
  - 水
  - IPv6
  - Nginx
---
## 前言
眼馋搬瓦工的`OpenVZ`已久，今天终于把服务器折腾上了`IPv6`地址

顺便升级到了`Ubuntu 18.10`，把`TLS1.3`支持加上了

<!-- more -->
## OpenVZ or KVM
之前买服务器的时候，看着搬瓦工有两种虚拟化方式可选，分别是`KVM`和`OpenVZ`

当时还是小白的我并不懂这两种有什么区别，不过看到搬瓦工自己的介绍说：

```
OpenVZ 拥有：
IPv6 支持
更好的 CPU 性能

KVM 拥有：
完整的虚拟化
可自定义内核(如：BBR、支持 Docker)
更好的隔离
更好的网络性能
```

当初的目的是买个服务器当梯子，来代替愈发难以连接的`GAE`，反正是买最低配的，`CPU`性能当然是没什么卵用，`IPv6`，emmm，天朝好像也不支持，似乎也没什么卵用，而且`KVM`可玩性高呀，可以上`BBR`，还有更好的网络性能，果断适合做梯子呀，于是当初就选择了`KVM`。

大概从今年初开始吧，看到国家哪哪又怎么推`IPv6`，一直感到很眼馋，一直想着再等等说不定运营商就把我这边的网络升级了呢？

直到我最近搞到了路由器的后台密码，进去瞅了一眼很绝望的发现，`TPLink`的路由器真是省成本省到家了，这货的固件压根就不支持`IPv6`

好吧，感觉等是无望了，刚好本月出了点小失误，发现的时候已经晚了，服务器的流量还剩下不到`10GB`，于是向败个新的`OpenVZ`的服务器，一来顶一顶严重不足的流量，二来试试`IPv6`的感觉

嗯然后就开始查`IPv6`，突然发现原来`KVM`也可以通过隧道支持`IPv6`的，emmm 掰着指头数了数日子，剩下的流量省着点大概也能撑到重置，于是决定不买了，折腾一下试试吧

## IPv6
照着网上一篇博客的教程，首先打开[tunnelbroker](https://tunnelbroker.net)，注册账号，申请隧道，一切都很顺利，然后照着网站给的说明把配置填到`/etc/network/interfaces`里，嗯，一切顺利，只差重启

之后一个重启，执行`ifconfig`，看到了我的`IPv6`地址，嗯很舒服，然后就开始折腾`ss`看怎么能让我在自己的电脑上能访问`IPv6`的网站

折腾了一整晚，怎么弄怎么不通，最后很绝望的去睡了。。。

第二天，我试着在服务器上`ping`了下`google.com`，emmm，`ping`不通，`curl -6 google.com`也无法访问，直接 ping Google IPv6 的`IP`也不管用，emmm 好像是`IPv6`本身不通？

于是又折腾了一晚上，因为我也不大懂这个隧道的原理，所以也只能是去找各种博客，尝试各种配置，以及`tunnelbroker`上其他环境的配置方式，都尝试过了，一个管用的都没有，最后我把`IPv6`的配置一删，想着再也不折腾了，还是等着看什么时候搬瓦工原生支持`IPv6`吧，然后睡觉去了。。。

今晚闲着无聊，于是又回来试。。。最后发现，我就近选的洛杉矶节点的`IPv4`地址是可以`ping`通的，延迟在`1ms`以内，但`IPv6`的地址怎么也`ping`不通，换成纽约的节点之后，居然。。。就自己好了。。除了延迟高了点。。服务器上可以正常访问`IPv6`的站点，`ss`代理一点也没改，我本地直接就能访问`IPv6`的网站了。。真是坑。。。

然后又挨个节点试了试，选了一个延迟在`10ms`以下的节点，再改了下`Nginx`配置，加了`IPv6`的监听，于是本站正式支持`IPv6`了。。

## TLS1.3
跟`IPv6`一样，`TLS1.3`我也等很久了，甚至等的比`IPv6`更久，之前看到`openssl 1.1.1`终于发正式版了，感觉很激动，`Ubuntu`官方源应该很快也会升级上来吧，然鹅稳定版就是稳定版，`18.04 LTS`就认死了发布时的`openssl 1.1.0`

这两天顺便在`ppa`上看到`Ubuntu 18.10`开发版本的源已经升级到`openssl 1.1.1`了，于是把服务器升级到了这个开发版本，再稍微折腾了下，算是支持`TLS1.3`了

不过开发版本目前还是有坑的，`Nginx`不支持选择`TLS1.3`的`ciphers`，`OCSP Staple`似乎也挂了，等`18.10`正式发布应该会好些吧。。

由于主流浏览器尚未兼容，目前本站暂时维持支持`TLS1.2 + TLS1.3`，等主流浏览器的最新版都支持之后，将改为只保留`TLS1.3`

到那个时候，大概又有新的东西可以折腾了吧。。。
